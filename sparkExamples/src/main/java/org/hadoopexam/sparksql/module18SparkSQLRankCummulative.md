Spark SQL Ranking and Cummulative usage 